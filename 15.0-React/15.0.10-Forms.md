# React - Formulaires et Validation

Les formulaires... **Le truc le plus chiant** √† g√©rer en React ! üò≠

Mais pas de panique, on va voir comment faire √ßa **proprement** et **efficacement** avec les bons outils !

---

## Le Probl√®me avec les Formulaires React

### L'Approche Vanilla React (√† √©viter)

```jsx
// ‚ùå Code horrible qu'on voit partout...
function ContactForm() {
  const [nom, setNom] = useState('')
  const [email, setEmail] = useState('')
  const [message, setMessage] = useState('')
  const [errors, setErrors] = useState({})

  const handleSubmit = (e) => {
    e.preventDefault()
    
    // Validation manuelle... beurk
    const newErrors = {}
    if (!nom) newErrors.nom = 'Le nom est requis'
    if (!email) newErrors.email = 'L\'email est requis'
    else if (!/\S+@\S+\.\S+/.test(email)) {
      newErrors.email = 'Email invalide'
    }
    if (!message) newErrors.message = 'Le message est requis'
    
    if (Object.keys(newErrors).length > 0) {
      setErrors(newErrors)
      return
    }
    
    // Submit...
    console.log({ nom, email, message })
  }

  return (
    <form onSubmit={handleSubmit}>
      <div>
        <input
          value={nom}
          onChange={(e) => setNom(e.target.value)}
          placeholder="Nom"
        />
        {errors.nom && <span>{errors.nom}</span>}
      </div>
      
      <div>
        <input
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="Email"
        />
        {errors.email && <span>{errors.email}</span>}
      </div>
      
      <div>
        <textarea
          value={message}
          onChange={(e) => setMessage(e.target.value)}
          placeholder="Message"
        />
        {errors.message && <span>{errors.message}</span>}
      </div>
      
      <button type="submit">Envoyer</button>
    </form>
  )
}
```

### Les Probl√®mes

- ü§Æ **Boilerplate de malade** : √©tat pour chaque champ
- üìã **Validation manuelle** : code r√©p√©titif partout
- üêõ **Erreurs faciles** : oublis, typos, inconsistances
- üìä **Pas de r√©utilisabilit√©** : chaque formulaire = refaire tout
- üéØ **Performance** : re-render √† chaque frappe

---
## Les Solutions Modernes

### 1. React Hook Form - LE BOSS ! üî•

```bash
npm install react-hook-form
```

**Le m√™me formulaire, mais version pro :**

```jsx
// ‚úÖ React Hook Form - Clean et efficace !
import { useForm } from 'react-hook-form'

function ContactForm() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting }
  } = useForm()

  const onSubmit = async (data) => {
    console.log(data) // { nom: '...', email: '...', message: '...' }
    
    // Simulation d'une requ√™te API
    await new Promise(resolve => setTimeout(resolve, 1000))
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div>
        <input
          {...register('nom', { 
            required: 'Le nom est requis',
            minLength: { value: 2, message: 'Min 2 caract√®res' }
          })}
          placeholder="Nom"
        />
        {errors.nom && <span>{errors.nom.message}</span>}
      </div>
      
      <div>
        <input
          {...register('email', { 
            required: 'L\'email est requis',
            pattern: {
              value: /\S+@\S+\.\S+/,
              message: 'Email invalide'
            }
          })}
          placeholder="Email"
        />
        {errors.email && <span>{errors.email.message}</span>}
      </div>
      
      <div>
        <textarea
          {...register('message', { 
            required: 'Le message est requis',
            minLength: { value: 10, message: 'Min 10 caract√®res' }
          })}
          placeholder="Message"
        />
        {errors.message && <span>{errors.message.message}</span>}
      </div>
      
      <button type="submit" disabled={isSubmitting}>
        {isSubmitting ? 'Envoi...' : 'Envoyer'}
      </button>
    </form>
  )
}
```

### 2. Avec Zod pour la Validation - Le Combo Parfait ! ‚ö°

```bash
npm install zod @hookform/resolvers
```

```jsx
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'

// Sch√©ma de validation
const contactSchema = z.object({
  nom: z.string()
    .min(1, 'Le nom est requis')
    .min(2, 'Au moins 2 caract√®res'),
  email: z.string()
    .min(1, 'L\'email est requis')
    .email('Format email invalide'),
  message: z.string()
    .min(1, 'Le message est requis')
    .min(10, 'Au moins 10 caract√®res'),
  age: z.number()
    .min(18, 'Vous devez √™tre majeur')
    .max(120, '√Çge invalide'),
  acceptTerms: z.boolean()
    .refine(val => val === true, 'Vous devez accepter les conditions')
})

type ContactFormData = z.infer<typeof contactSchema>

function ContactFormAdvanced() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset
  } = useForm<ContactFormData>({
    resolver: zodResolver(contactSchema),
    defaultValues: {
      nom: '',
      email: '',
      message: '',
      age: 18,
      acceptTerms: false
    }
  })

  const onSubmit = async (data: ContactFormData) => {
    try {
      // API call
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })

      if (!response.ok) throw new Error('Erreur serveur')

      alert('Message envoy√© avec succ√®s !')
      reset() // Reset le formulaire
    } catch (error) {
      alert('Erreur lors de l\'envoi')
    }
  }

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
      <div>
        <input
          {...register('nom')}
          placeholder="Nom complet"
          className={errors.nom ? 'border-red-500' : ''}
        />
        {errors.nom && <p className="text-red-500">{errors.nom.message}</p>}
      </div>

      <div>
        <input
          {...register('email')}
          type="email"
          placeholder="Email"
          className={errors.email ? 'border-red-500' : ''}
        />
        {errors.email && <p className="text-red-500">{errors.email.message}</p>}
      </div>

      <div>
        <input
          {...register('age', { valueAsNumber: true })}
          type="number"
          placeholder="√Çge"
          min="18"
          className={errors.age ? 'border-red-500' : ''}
        />
        {errors.age && <p className="text-red-500">{errors.age.message}</p>}
      </div>

      <div>
        <textarea
          {...register('message')}
          placeholder="Votre message"
          rows={4}
          className={errors.message ? 'border-red-500' : ''}
        />
        {errors.message && <p className="text-red-500">{errors.message.message}</p>}
      </div>

      <div className="flex items-center">
        <input
          {...register('acceptTerms')}
          type="checkbox"
          id="terms"
        />
        <label htmlFor="terms" className="ml-2">
          J'accepte les conditions d'utilisation
        </label>
      </div>
      {errors.acceptTerms && <p className="text-red-500">{errors.acceptTerms.message}</p>}

      <button 
        type="submit" 
        disabled={isSubmitting}
        className={`px-4 py-2 rounded ${isSubmitting ? 'bg-gray-400' : 'bg-blue-500 hover:bg-blue-600'}`}
      >
        {isSubmitting ? 'Envoi en cours...' : 'Envoyer'}
      </button>
    </form>
  )
}
```

---

## Points Cl√©s √† Retenir

1. **React Hook Form** = LA solution moderne
2. **Zod** = validation TypeScript-first parfaite
3. **Performance** = pas de re-render √† chaque frappe
4. **Server Actions** = full-stack sans API avec Next.js
5. **Custom Hooks** = r√©utilisabilit√© et logique m√©tier
6. **Validation c√¥t√© serveur** = TOUJOURS n√©cessaire
7. **UX** = feedback visuel et √©tats de chargement

---

## Mon Conseil Personnel

**Utilise TOUJOURS React Hook Form + Zod** pour tes formulaires.

Pourquoi ?
- ‚úÖ **Performance** : minimal re-renders
- ‚úÖ **DX** : TypeScript natif avec Zod
- ‚úÖ **Flexibilit√©** : contr√¥le total sur l'UX
- ‚úÖ **Bundle size** : plus l√©ger que Formik
- ‚úÖ **Communaut√©** : tr√®s actif et support√©

---

## Ressources Pour Aller Plus Loin

- üìö [React Hook Form Docs](https://react-hook-form.com/)
- üîß [Zod Documentation](https://zod.dev/)
- üé• [React Hook Form Tutorial](https://www.youtube.com/watch?v=RkXv4AXXC_4)
- üìñ [Form Validation Guide](https://www.robinwieruch.de/react-form/)
- ‚ö° [Next.js Forms Guide](https://nextjs.org/docs/guides/building-forms)

---

**Prochaine √©tape :** On va voir la **validation avanc√©e** et **TypeScript** avec Zod dans `15.0.11-Type-validations.md` ! üõ°Ô∏è
