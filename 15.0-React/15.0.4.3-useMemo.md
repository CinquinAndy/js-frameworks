# React - useMemo : Optimisation des Calculs

Quand ton composant fait des calculs coÃ»teux Ã  chaque rendu, useMemo va **mÃ©moriser** le rÃ©sultat et ne le recalculer que si les dÃ©pendances changent.

---

## Le ProblÃ¨me des Recalculs Inutiles

### Calculs CoÃ»teux Ã  Chaque Rendu

```jsx
function SlowComponent({ items, filter }) {
  const [count, setCount] = useState(0)

  // âŒ PROBLÃˆME - Calcul coÃ»teux Ã  CHAQUE rendu !
  const expensiveValue = items
    .filter(item => item.category === filter)
    .reduce((sum, item) => sum + item.price, 0)
  
  console.log('ğŸ’° Calcul coÃ»teux exÃ©cutÃ© !') // â† Se dÃ©clenche mÃªme quand count change !

  // âŒ PROBLÃˆME - Nouvel objet Ã  chaque rendu !
  const chartConfig = {
    type: 'bar',
    data: expensiveValue,
    options: { responsive: true }
  }

  // âŒ PROBLÃˆME - Tableau recalculÃ© Ã  chaque rendu !
  const sortedItems = items
    .filter(item => item.category === filter)
    .sort((a, b) => b.price - a.price)

  return (
    <div>
      <h3>Total: {expensiveValue}â‚¬</h3>
      <p>Count: {count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
      
      <ExpensiveChart config={chartConfig} />
      <ItemsList items={sortedItems} />
    </div>
  )
}

// Ces composants re-render mÃªme si leurs props n'ont pas vraiment changÃ© !
const ExpensiveChart = memo(function ExpensiveChart({ config }) {
  console.log('ğŸ“Š ExpensiveChart re-rendu') // â† Toujours appelÃ© car config est toujours un nouvel objet !
  return <div>Chart avec config: {JSON.stringify(config)}</div>
})

const ItemsList = memo(function ItemsList({ items }) {
  console.log('ğŸ“ ItemsList re-rendu') // â† Toujours appelÃ© car items est toujours un nouveau tableau !
  return (
    <ul>
      {items.map(item => (
        <li key={item.id}>{item.name} - {item.price}â‚¬</li>
      ))}
    </ul>
  )
})
```

---

## useMemo Ã  la Rescousse

### Syntaxe et Usage Basique

```jsx
import { useMemo } from 'react'

function OptimizedComponent({ items, filter }) {
  const [count, setCount] = useState(0)

  // âœ… SOLUTION - Calcul seulement si items ou filter changent
  const expensiveValue = useMemo(() => {
    console.log('ğŸ’° Calcul coÃ»teux exÃ©cutÃ©') // â† Seulement si nÃ©cessaire !
    
    return items
      .filter(item => item.category === filter)
      .reduce((sum, item) => sum + item.price, 0)
  }, [items, filter]) // â† DÃ©pendances

  // âœ… Objet complexe mÃ©morisÃ©
  const chartConfig = useMemo(() => {
    console.log('ğŸ“Š Configuration chart gÃ©nÃ©rÃ©e')
    
    return {
      type: 'bar',
      data: expensiveValue,
      options: { responsive: true },
      theme: 'modern'
    }
  }, [expensiveValue])

  // âœ… DonnÃ©es filtrÃ©es et triÃ©es mÃ©morisÃ©es
  const sortedItems = useMemo(() => {
    console.log('ğŸ” Filtrage et tri des items')
    
    return items
      .filter(item => item.category === filter)
      .sort((a, b) => b.price - a.price) // Tri par prix dÃ©croissant
  }, [items, filter])

  return (
    <div>
      <h3>Total: {expensiveValue}â‚¬</h3>
      <p>Count: {count} (ne dÃ©clenche plus le calcul !)</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
      
      <ExpensiveChart config={chartConfig} />
      <ItemsList items={sortedItems} />
    </div>
  )
}

// Maintenant ces composants ne re-render que si leurs props changent vraiment !
const ExpensiveChart = memo(function ExpensiveChart({ config }) {
  console.log('ğŸ“Š ExpensiveChart re-rendu') // â† Seulement si config change vraiment
  return <div>Chart avec config: {JSON.stringify(config)}</div>
})

const ItemsList = memo(function ItemsList({ items }) {
  console.log('ğŸ“ ItemsList re-rendu') // â† Seulement si items change vraiment
  return (
    <ul>
      {items.map(item => (
        <li key={item.id}>{item.name} - {item.price}â‚¬</li>
      ))}
    </ul>
  )
})
```

---

## Ressources Pour Aller Plus Loin

- ğŸ“š [useMemo Documentation](https://react.dev/reference/react/useMemo)
- ğŸ’¡ [When to useMemo](https://kentcdodds.com/blog/usememo-and-usecallback)
- âš¡ [React Performance](https://react.dev/learn/render-and-commit)
- ğŸ”§ [React DevTools Profiler](https://react.dev/blog/2018/09/10/introducing-the-react-profiler)
