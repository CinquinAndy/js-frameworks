# React - Rendu et Virtual DOM

React suit une approche **dÃ©clarative** pour le rendu des composants, ce qui signifie que tu spÃ©cifies **ce Ã  quoi** un composant doit ressembler, et React s'occupe de l'afficher Ã  l'Ã©cran. C'est l'opposÃ© d'une approche **impÃ©rative**, oÃ¹ tu Ã©crirais du code pour manipuler manuellement le DOM.

---

## Le Processus de Rendu React

### Les 3 Ã©tapes fondamentales

React fonctionne comme un **serveur dans un restaurant** :

1. **ğŸ¯ Trigger (DÃ©clenchement)** - Le client passe commande
2. **ğŸ”„ Render (Rendu)** - Le chef prÃ©pare le plat
3. **ğŸ“¦ Commit (Validation)** - Le serveur apporte le plat

```jsx
function ExempleRendu() {
  const [count, setCount] = useState(0)

  console.log('ğŸ”„ RENDER: Composant en cours de rendu')

  const handleClick = () => {
    console.log('ğŸ¯ TRIGGER: Changement d\'Ã©tat dÃ©clenchÃ©')
    setCount(count + 1) // â† DÃ©clenche un nouveau rendu
  }

  return (
    <div>
      <p>Compteur: {count}</p>
      <button onClick={handleClick}>+1</button>
    </div>
  )
}
```

### 1. Trigger - Quand React dÃ©cide de faire un rendu

React fait un rendu dans **2 cas seulement** :

```jsx
function QuandReactRend() {
  const [state, setState] = useState(0)

  // âœ… CAS 1: Rendu initial (premiÃ¨re fois)
  useEffect(() => {
    console.log('ğŸ¬ Premier rendu du composant')
  }, [])

  // âœ… CAS 2: Changement d'Ã©tat
  const triggerReRender = () => {
    setState(state + 1) // â† DÃ©clenche un re-rendu
  }

  return (
    <div>
      <p>State: {state}</p>
      <button onClick={triggerReRender}>Changer Ã©tat</button>
    </div>
  )
}
```

### 2. Render - React appelle tes composants

```jsx
function ExempleRenderPur() {
  const [count, setCount] = useState(0)

  // âš ï¸ Cette fonction DOIT Ãªtre pure !
  // MÃªmes inputs = mÃªmes outputs
  console.log('ğŸ”„ Render appelÃ© avec count =', count)

  return <div>Count: {count}</div>
}

// âŒ MAUVAIS - Effet de bord pendant le render
function BadExample() {
  const [count, setCount] = useState(0)

  // âŒ Ne jamais faire Ã§a dans le render !
  document.title = `Count: ${count}` // Effet de bord
  Math.random() // Non-dÃ©terministe

  return <div>{count}</div>
}

// âœ… BON - Render pur
function GoodExample() {
  const [count, setCount] = useState(0)

  // âœ… Effets de bord dans useEffect
  useEffect(() => {
    document.title = `Count: ${count}`
  }, [count])

  return <div>{count}</div>
}
```

### 3. Commit - React met Ã  jour le DOM

```jsx
function ExempleCommit() {
  const [color, setColor] = useState('red')

  return (
    <div>
      {/* React ne mettra Ã  jour QUE la couleur dans le DOM */}
      <div style={{ backgroundColor: color, padding: '20px' }}>
        <h2>Titre inchangÃ©</h2>
        <p>Paragraphe inchangÃ©</p>
        <button onClick={() => setColor(color === 'red' ? 'blue' : 'red')}>
          Changer couleur
        </button>
      </div>
    </div>
  )
}
```

---

## Virtual DOM - La Magie de React

### Qu'est-ce que le Virtual DOM ?

Le **Virtual DOM (VDOM)** est une reprÃ©sentation **en mÃ©moire** du DOM rÃ©el. C'est comme un **brouillon** que React utilise pour optimiser les mises Ã  jour.

```jsx
// Ce que tu Ã©cris en JSX
function MonComposant() {
  return (
    <div className="container">
      <h1>Titre</h1>
      <p>Paragraphe</p>
    </div>
  )
}

// Ce que React crÃ©e en Virtual DOM (simplifiÃ©)
const virtualDOM = {
  type: 'div',
  props: { className: 'container' },
  children: [
    { type: 'h1', props: {}, children: ['Titre'] },
    { type: 'p', props: {}, children: ['Paragraphe'] }
  ]
}
```

### Le Processus de RÃ©conciliation

```jsx
function ExempleReconciliation() {
  const [items, setItems] = useState(['A', 'B', 'C'])

  const ajouterItem = () => {
    setItems([...items, `Item ${Date.now()}`])
  }

  return (
    <div>
      <h2>Liste d'items</h2>
      {/*
        React compare :
        - AVANT: ['A', 'B', 'C']
        - APRÃˆS: ['A', 'B', 'C', 'Item 12345']

        RÃ©sultat: React ajoute SEULEMENT le nouvel Ã©lÃ©ment au DOM
      */}
      <ul>
        {items.map((item, index) => (
          <li key={index}>{item}</li>
        ))}
      </ul>
      <button onClick={ajouterItem}>Ajouter item</button>
    </div>
  )
}
```

### Pourquoi c'est important ?

```jsx
// Sans Virtual DOM (manipulation directe)
function updateWithoutVDOM() {
  // âŒ Lent et inefficace
  document.getElementById('title').textContent = 'Nouveau titre'
  document.getElementById('count').textContent = '42'
  document.getElementById('status').className = 'active'
  // ... 50 autres mises Ã  jour
}

// Avec Virtual DOM (React)
function updateWithVDOM() {
  // âœ… React calcule automatiquement les changements minimaux
  setTitle('Nouveau titre')
  setCount(42)
  setStatus('active')
  // React met Ã  jour SEULEMENT ce qui a changÃ©
}
```

### DÃ©monstration pratique

```jsx
function DemoVirtualDOM() {
  const [highlightIndex, setHighlightIndex] = useState(0)

  useEffect(() => {
    const interval = setInterval(() => {
      setHighlightIndex(prev => (prev + 1) % 5)
    }, 1000)

    return () => clearInterval(interval)
  }, [])

  return (
    <div>
      <h3>React met Ã  jour SEULEMENT l'Ã©lÃ©ment surlignÃ©</h3>
      <ul>
        {['Item 1', 'Item 2', 'Item 3', 'Item 4', 'Item 5'].map((item, index) => (
          <li
            key={index}
            style={{
              backgroundColor: index === highlightIndex ? 'yellow' : 'transparent',
              padding: '10px',
              transition: 'background-color 0.3s'
            }}
          >
            {item}
          </li>
        ))}
      </ul>
      <p>ğŸ‘† Ouvre les DevTools et regarde: seule la couleur change dans le DOM !</p>
    </div>
  )
}
```

---

## Ressources pour aller plus loin

- ğŸ“– [Rendu et Commit](https://react.dev/learn/render-and-commit)
- ğŸ” [Pourquoi React re-rend](https://ui.dev/why-react-renders)
- ğŸ¯ [RÃ©fÃ©rences avec useRef](https://react.dev/learn/referencing-values-with-refs)
- ğŸ› ï¸ [Manipuler le DOM avec refs](https://react.dev/learn/manipulating-the-dom-with-refs)
- âš¡ [RÃ©pondre aux Ã©vÃ©nements](https://react.dev/learn/responding-to-events)
- ğŸ”— [Higher-Order Components](https://www.robinwieruch.de/react-higher-order-components/)
